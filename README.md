# Custom CloudWatch Logger

## What is it for:
This package is to solve a single problem: to write error log (both in string, array and Exception) format to AWS Cloudwatch.

The variables will be `json_encode()` into string value and put it to Cloudwatch.

## Tested environment
- I am testing it using Docker PHP 8.2.  Since I am using [Null Coalescing Operator](https://www.php.net/manual/en/migration70.new-features.php) (`??`), the minimum requirement is PHP7.0

## Composer Dependencies
- `"aws/aws-sdk-php": "^3"`

## Notes
- Make sure you have necessary permission to create loggroup and logstream.
- If the code cannot create either loggroup or logstream, a tradition `error_log` function is used to log this event
- By default the log group name is `PHPApplicationErrors` and log stream name in the log group is `ErrorLogStream`.
- If you read the source code `CloudWatchErrorLogger.php`, you will see that I put the whole `$awsConfig` inside the constructor.
  - Which means, if you want to add other configuration, add it in `$awsConfig`

## How to create custom log group name and log stream name

Here you are:

```php
$my_settigs = [
    'logGroupName' => 'test-log-group',
    'logStreamName' => 'test-log-stream',
];
$cloudWatchErrorLogger = new CloudWatchErrorLogger($awsConfig, $my_settigs);
```

`$my_settigs` is an associative array.  At present the code only check below two array keys (The name implies itself, I would not explain it):
- `logGroupName`
- `logStreamName`

## Known(?) issue(s)

- I haven't tested using AWS cert or other crediential setting.  I love to use `key` and `secret` because it is simple and work.

## Example - Default
```php
<?php
// Assume this is the test PHP code in your test project that uses the CustomCloudWatchLogger package

// Require the Composer autoloader to autoload the CustomCloudWatchLogger package and its dependencies
require 'vendor/autoload.php';

// Import the CloudWatchErrorLogger class from the CustomCloudWatchLogger package
use Elleryleung\CustomCloudwatchLogger\CloudWatchErrorLogger;

// Create AWS config for the CloudWatchErrorLogger
$awsConfig = [
    'region' => 'ap-east-1',
    'version' => 'latest',
    'credentials' => [
        'key' => 'your_aws_key',
        'secret' => 'your_aws_secret',
    ],
];

// Create an instance of the CloudWatchErrorLogger
$cloudWatchErrorLogger = new CloudWatchErrorLogger($awsConfig);

// Log a sample error to CloudWatch
$errorData = [
    'errno' => 123,
    'errstr' => 'Sample error message',
    'errfile' => 'sample.php',
    'errline' => 12,
];
$cloudWatchErrorLogger->logErrorToCloudWatch($errorData);

// Log a sample exception to CloudWatch
try {
    // This could be any code that may throw an exception
    throw new Exception('Sample exception message');
} catch (Exception $e) {
    $exceptionData = [
        'message' => $e->getMessage(),
        'file' => $e->getFile(),
        'line' => $e->getLine(),
    ];
    $cloudWatchErrorLogger->logErrorToCloudWatch($exceptionData);
}
```

### Use default `logGroupName` and `logStreamName`
![AWS Cloudwatch result](result.png "AWS Cloudwatch result")

## Example - Custom `logGroupName` and `logStreamName`
```php
$custom = [
    'logGroupName' => 'test-log-group',
    'logStreamName' => 'test-log-stream',
];
$cloudWatchErrorLogger = new CloudWatchErrorLogger($awsConfig, $custom);

// Log a sample error to CloudWatch
$errorData = [
    'logGroupName' => $custom['logGroupName'],
    'logStreamName' => $custom['logStreamName'],
    'errno' => 123,
    'errstr' => 'Sample error message',
    'errfile' => 'sample.php',
    'errline' => 12,
];
$cloudWatchErrorLogger->logErrorToCloudWatch($errorData);

// Log a sample exception to CloudWatch
try {
    // This could be any code that may throw an exception
    throw new Exception('Sample exception message');
} catch (Exception $e) {
    $exceptionData = [
        'logGroupName' => $custom['logGroupName'],
        'logStreamName' => $custom['logStreamName'],
        'message' => $e->getMessage(),
        'file' => $e->getFile(),
        'line' => $e->getLine(),
    ];
    $cloudWatchErrorLogger->logErrorToCloudWatch($exceptionData);
}
```

### Use custom `logGroupName` and `logStreamName`
![AWS Cloudwatch result using custom name](custom-result.png "AWS Cloudwatch result using custom name")


## Special thanks
- `Codeium`: 80% or more of the code is generated by AI (Codeium) in VSCode.  20% of the code is added by me.